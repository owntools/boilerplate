name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Check docker daemon
        run: docker ps

      - uses: whoan/docker-build-with-cache-action@master
        with:
          username: owntools
          password: "${{ secrets.DOCKER_PASSWORD }}"
          image_name: owntools/nodejs
          context: nodejs

      - name: Check docker images
        run: docker images

      - name: Test all
        run: cd nodejs && make test
